
@{
    ViewBag.Title = "Applied Jobs";
}


@if (Session["objUser"] == null || Session["UserEmail"] == null)
{
    Response.Redirect("~/Account/Login");
}
else
{
    <div class="progress-container mt-2">
        <div class="progress">
            <div class="progress-bar bg-info progress-bar-striped custom-progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <span class="progress-text"></span>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="card my-2">
                <div class="card-body">
                        <div class="row">
                            
                            <div class="card-header my-2">
                                <h5><strong>Applied Jobs</strong></h5>
                            </div>
                        </div>
                    <div class="table-responsive">
                        <table id="AppliedJobsTable" class="table table-striped table-bordered table-condensed table-hover mx-auto text-center">
                            <tr>
                                <th scope="col">SL.</th>
                                <th scope="col">Job Post</th>
                                <th scope="col">Job Type</th>
                                <th scope="col">Vacancy</th>
                                <th scope="col">Experience Required</th>
                                <th scope="col">Short Listed?</th>
                                <th scope="col">Applied Date</th>

                                <th scope="col" hidden>AppliedJobsId</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
}


<script>

    $(document).ready(function () {
        loadAppliedJobs();
        loadProgressBar();
    });


    function loadAppliedJobs() {
        $.ajax({
            type: "GET",
            url: "@Url.Action("loadAppliedJobs", "Applicant")",
            dataType: "json",
            success: function (response) {
                debugger;
                if (response.length > 0) {
                    let table = document.getElementById("AppliedJobsTable");
                    for (var i = 0; i < response.length; i++) {
                        let newRow = table.insertRow(table.rows.length);

                        // Insert data into cells of the new row
                        newRow.insertCell(0).innerHTML = i+1;
                        newRow.insertCell(1).innerHTML = response[i].JobVacancyPost.DesignationTitle;
                        newRow.insertCell(2).innerHTML = response[i].JobVacancyPost.JobType;
                        newRow.insertCell(3).innerHTML = response[i].JobVacancyPost.NoOfVacancy;
                        newRow.insertCell(4).innerHTML = response[i].JobVacancyPost.ExperienceRequired;
                        newRow.insertCell(5).innerHTML = response[i].AppliedJob.IsShortListed;

                        var milliseconds = parseInt(response[i].AppliedJob.AppliedDate.replace('/Date(', '').replace(')/', ''), 10);
                        var formatedDate = new Date(milliseconds);
                        //var dt = formatedDate.toISOString().substr(0, 10);
                        var options = { year: 'numeric', month: 'long', day: 'numeric' };
                        var formattedDateString = formatedDate.toLocaleDateString(undefined, options);

                        newRow.insertCell(6).innerHTML = formattedDateString;
                        newRow.insertCell(7).innerHTML = response[i].AppliedJob.AppliedJobsId;
                        $(newRow.cells[7]).hide();
                        for (let i = 0; i < 7; i++) {
                            newRow.cells[i].style.textAlign = "center";
                        }
                    }
                }
                else {
                    let table = document.getElementById("AppliedJobsTable");
                    let newRow = table.insertRow(table.rows.length);
                    let cell = newRow.insertCell(0);
                    cell.colSpan = 7;
                    cell.innerHTML = "No Data Found!";
                    cell.style.textAlign = "center";
                }

            },
            error: function (error) {
                console.log("Error loading  info:", error);
            }
        });
    }

    function loadProgressBar() {
        var progress = $(".progress-bar");
        var currentProgress = progress.attr("aria-valuenow");
        $.ajax({
            url: "@Url.Action("GetProgress", "Applicant")",
            type: 'GET',
            dataType: 'json',
            success: function (data) {


                var newProgress = parseInt(data) * 25;

                progress.css("width", newProgress + "%");
                progress.attr("aria-valuenow", newProgress);
                document.querySelector(".progress-text").textContent = newProgress + "% Completed";
            },
            error: function (xhr, status, error) {
                console.error('Error fetching progress data: ' + error);
            }
        });

    }

</script>
